<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <link rel="icon" type="image/svg+xml" href="/vite.svg" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>AdTech Toolbox</title>
  
  <!-- Cookie-Script CMP mit callback für Werbe-Consent -->
  <script type="text/javascript" charset="UTF-8" src="//cdn.cookie-script.com/s/df3b1e2691222d50070cbd174a87a43c.js"></script>
  
  <!-- Cookie-Consent-Management -->
  <script>
    window.CONSENT_STATUS = {
      analytics: false,
      advertising: false,
      initialized: false
    };
    
    // Cookie-Script Callback - wird nach User-Consent aufgerufen
    window.cookieScriptConsent = function(consent) {
      console.log("Cookie consent update:", consent);
      // Werbe-Consent aktivieren wenn 'advertising' erlaubt ist
      window.CONSENT_STATUS.analytics = consent.analytics || false;
      window.CONSENT_STATUS.advertising = consent.advertising || false;
      window.CONSENT_STATUS.initialized = true;
      
      // Event auslösen um andere Skripte zu informieren
      var consentEvent = new CustomEvent('consentUpdate', { 
        detail: { consent: window.CONSENT_STATUS } 
      });
      window.dispatchEvent(consentEvent);
      
      // GPT aktualisieren wenn geladen
      if (window.googletag && googletag.pubads) {
        googletag.cmd.push(function() {
          console.log("Updating GPT consent:", window.CONSENT_STATUS.advertising);
          // 0 = personalisiert, 1 = nicht-personalisiert
          googletag.pubads().setRequestNonPersonalizedAds(window.CONSENT_STATUS.advertising ? 0 : 1);
          googletag.pubads().refresh();
        });
      }
    };
  </script>
  
  <!-- GPT - Google Publisher Tag -->
  <script async src="https://securepubads.g.doubleclick.net/tag/js/gpt.js"></script>
  <script>
    window.googletag = window.googletag || {cmd: []};
    
    googletag.cmd.push(function() {
      // Definiere Ad-Slots
      googletag.defineSlot('/19968336/adtech-toolbox-bottom', 
                          [[728, 90], [970, 90]], 
                          'div-gpt-ad-bottom')
              .addService(googletag.pubads());
                        
      googletag.defineSlot('/19968336/adtech-toolbox-left', 
                          [160, 600], 
                          'div-gpt-ad-left')
              .addService(googletag.pubads());
                        
      googletag.defineSlot('/19968336/adtech-toolbox-right', 
                          [[300, 600], [300, 250]], 
                          'div-gpt-ad-right')
              .addService(googletag.pubads());
              
      // Targeting Parameter
      googletag.pubads().setTargeting('tool', ['json-explorer']);
      googletag.pubads().setTargeting('env', ['production']);
      
      // Default: Non-personalized ads, bis Consent vorliegt
      googletag.pubads().setRequestNonPersonalizedAds(1);
      
      // GPT Einstellungen
      googletag.pubads().enableSingleRequest();
      googletag.pubads().collapseEmptyDivs();
      googletag.enableServices();
      
      // Auf consentUpdate Event hören
      window.addEventListener('consentUpdate', function(event) {
        if (event.detail.consent.advertising) {
          console.log("Ad consent detected, refreshing ads");
          // 0 = personalisiert, 1 = nicht-personalisiert
          googletag.pubads().setRequestNonPersonalizedAds(0);
          googletag.pubads().refresh();
        }
      });
      
      // Wenn bereits Consent vorliegt, anwenden
      if (window.CONSENT_STATUS && window.CONSENT_STATUS.initialized && window.CONSENT_STATUS.advertising) {
        googletag.pubads().setRequestNonPersonalizedAds(0);
      }
    });
  </script>
</head>
<body>
  <div id="root"></div>
  <script type="module" src="/src/main.jsx"></script>
</body>
</html>