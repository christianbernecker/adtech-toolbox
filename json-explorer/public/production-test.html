<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AdTech Toolbox - Produktionstest</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, sans-serif;
            margin: 0;
            padding: 0;
            background-color: #f8f9fa;
            min-height: 100vh;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 2rem;
        }
        header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 2rem;
            border-bottom: 1px solid #dee2e6;
            padding-bottom: 1rem;
        }
        .logo {
            display: flex;
            align-items: center;
        }
        .logo-icon {
            width: 40px;
            height: 40px;
            background-color: #4285f4;
            border-radius: 4px;
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 1rem;
        }
        .test-badge {
            background-color: #dc3545;
            color: white;
            padding: 0.25rem 0.5rem;
            border-radius: 0.25rem;
            font-weight: bold;
        }
        .ads-container {
            display: flex;
            margin-top: 2rem;
            min-height: 600px;
        }
        .sidebar {
            width: 300px;
            margin-right: 2rem;
        }
        .main-content {
            flex: 1;
        }
        .card {
            background-color: white;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            padding: 1.5rem;
            margin-bottom: 2rem;
        }
        h1 {
            margin-top: 0;
            color: #212529;
        }
        h2 {
            margin-top: 0;
            color: #495057;
            font-size: 1.25rem;
        }
        .test-ad {
            padding: 1rem;
            border: 1px dashed #dee2e6;
            border-radius: 4px;
            color: white;
            text-align: center;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            margin-bottom: 1rem;
        }
        .test-ad-left {
            width: 160px;
            height: 600px;
            background: linear-gradient(135deg, #4285f4, #34a853);
        }
        .test-ad-right {
            width: 300px;
            height: 250px;
            background: linear-gradient(135deg, #ea4335, #fbbc05);
        }
        .test-ad-banner {
            width: 100%;
            height: 90px;
            background: linear-gradient(90deg, #fbbc05, #ea4335);
            margin-top: 2rem;
        }
        .status {
            padding: 0.5rem;
            border-radius: 4px;
            margin-bottom: 0.5rem;
            font-size: 0.875rem;
        }
        .status-success {
            background-color: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        .status-warning {
            background-color: #fff3cd;
            color: #856404;
            border: 1px solid #ffeeba;
        }
        .status-danger {
            background-color: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        footer {
            margin-top: 4rem;
            padding-top: 2rem;
            border-top: 1px solid #dee2e6;
            text-align: center;
            color: #6c757d;
        }
    </style>
    
    <!-- Usercentrics CMP -->
    <script id="usercentrics-cmp" src="https://web.cmp.usercentrics.eu/ui/loader.js" data-settings-id="AVmhdo98bxlHZn" data-tcf-enabled></script>
    
    <!-- Google Publisher Tag -->
    <script async src="https://securepubads.g.doubleclick.net/tag/js/gpt.js"></script>
    <script>
        window.googletag = window.googletag || { cmd: [] };
        
        // Debug-Funktion, um CMP-Status anzuzeigen
        function updateCmpStatus() {
            const cmpStatusEl = document.getElementById('cmp-status');
            
            if (window.UC_UI && window.UC_UI.isInitialized()) {
                cmpStatusEl.textContent = 'CMP geladen und initialisiert';
                cmpStatusEl.className = 'status status-success';
                
                // CMP-Services prüfen
                const services = window.UC_UI.getServicesBaseInfo();
                let hasMarketingConsent = false;
                
                services.forEach(service => {
                    if (service.id === 'BJz7qNsdj-7' && service.consent.status === true) {
                        hasMarketingConsent = true;
                    }
                    
                    const serviceEl = document.createElement('div');
                    serviceEl.className = service.consent.status ? 'status status-success' : 'status status-warning';
                    serviceEl.textContent = `${service.name}: ${service.consent.status ? 'Zugestimmt' : 'Abgelehnt'}`;
                    document.getElementById('consent-services').appendChild(serviceEl);
                });
                
                document.getElementById('marketing-consent').textContent = hasMarketingConsent ? 'Erteilt' : 'Nicht erteilt';
                document.getElementById('marketing-consent').className = hasMarketingConsent ? 'status status-success' : 'status status-warning';
            } else {
                cmpStatusEl.textContent = 'CMP wird geladen...';
                cmpStatusEl.className = 'status status-warning';
                
                // Nach 5 Sekunden prüfen, ob CMP geladen wurde
                setTimeout(() => {
                    if (!window.UC_UI || !window.UC_UI.isInitialized()) {
                        cmpStatusEl.textContent = 'CMP konnte nicht geladen werden';
                        cmpStatusEl.className = 'status status-danger';
                    }
                }, 5000);
            }
        }
        
        // Ad-Status aktualisieren
        function updateAdStatus() {
            const adStatusEl = document.getElementById('ad-status');
            
            if (window.googletag && window.googletag.apiReady) {
                adStatusEl.textContent = 'Google Publisher Tag geladen';
                adStatusEl.className = 'status status-success';
            } else {
                adStatusEl.textContent = 'Google Publisher Tag wird geladen...';
                adStatusEl.className = 'status status-warning';
                
                // Nach 5 Sekunden prüfen, ob GPT geladen wurde
                setTimeout(() => {
                    if (!window.googletag || !window.googletag.apiReady) {
                        adStatusEl.textContent = 'Google Publisher Tag konnte nicht geladen werden';
                        adStatusEl.className = 'status status-danger';
                    }
                }, 5000);
            }
        }
        
        // GPT initialisieren
        googletag.cmd.push(function() {
            // Werbe-Slots definieren
            googletag.defineSlot('/19968336/adtech-toolbox-left', [160, 600], 'div-gpt-ad-left')
                .addService(googletag.pubads())
                .setTargeting('test', ['true']);
            
            googletag.defineSlot('/19968336/adtech-toolbox-right', [300, 250], 'div-gpt-ad-right')
                .addService(googletag.pubads())
                .setTargeting('test', ['true']);
            
            googletag.defineSlot('/19968336/adtech-toolbox-bottom', [728, 90], 'div-gpt-ad-bottom')
                .addService(googletag.pubads())
                .setTargeting('test', ['true']);
            
            // Targeting-Parameter setzen
            googletag.pubads().setTargeting('page', ['test']);
            
            // GPT konfigurieren
            googletag.pubads().enableSingleRequest();
            googletag.pubads().collapseEmptyDivs();
            
            // Listener für render-complete Events
            googletag.pubads().addEventListener('slotRenderEnded', function(event) {
                const slot = event.slot;
                const id = slot.getSlotElementId();
                const isEmpty = event.isEmpty;
                
                // Status-Updates anzeigen
                const statusEl = document.getElementById(`${id}-status`);
                if (statusEl) {
                    if (isEmpty) {
                        statusEl.textContent = 'Keine Anzeige ausgeliefert';
                        statusEl.className = 'status status-warning';
                    } else {
                        statusEl.textContent = 'Anzeige erfolgreich ausgeliefert';
                        statusEl.className = 'status status-success';
                        
                        // Test-Anzeige ausblenden, wenn echte Anzeige geladen
                        const testAd = document.getElementById(`${id}-test`);
                        if (testAd) {
                            testAd.style.display = 'none';
                        }
                    }
                }
            });
            
            // GPT aktivieren
            googletag.enableServices();
            
            // Status aktualisieren
            document.getElementById('gpt-initialized').textContent = 'GPT initialisiert';
            document.getElementById('gpt-initialized').className = 'status status-success';
        });
        
        // Nach Seitenladung GPT aufrufen
        window.addEventListener('load', function() {
            // Status aktualisieren
            updateCmpStatus();
            updateAdStatus();
            
            // Anzeigen anfordern
            googletag.cmd.push(function() {
                googletag.display('div-gpt-ad-left');
                googletag.display('div-gpt-ad-right');
                googletag.display('div-gpt-ad-bottom');
            });
        });
        
        // CMP-Events überwachen
        window.addEventListener('UC_UI_INITIALIZED', function() {
            updateCmpStatus();
        });
        
        window.addEventListener('UC_UI_CMP_EVENT', function(event) {
            if (event.detail.type === 'ACCEPT_ALL' || event.detail.type === 'DENY_ALL' || event.detail.type === 'SAVE') {
                // Alles neu laden, wenn Benutzer Einstellungen ändert
                location.reload();
            }
        });
    </script>
</head>
<body>
    <div class="container">
        <header>
            <div class="logo">
                <div class="logo-icon">A</div>
                <h1>AdTech Toolbox</h1>
            </div>
            <div class="test-badge">PRODUCTION TEST</div>
        </header>
        
        <div class="card">
            <h2>CMP-Statustest</h2>
            <div id="cmp-status" class="status status-warning">CMP wird geladen...</div>
            
            <h3>Consent-Status</h3>
            <div id="consent-services"></div>
            
            <h3>Marketing-Consent</h3>
            <div id="marketing-consent" class="status status-warning">Wird geprüft...</div>
        </div>
        
        <div class="card">
            <h2>Werbeintegrationsstatus</h2>
            <div id="ad-status" class="status status-warning">GPT wird geladen...</div>
            <div id="gpt-initialized" class="status status-warning">GPT-Initialisierung...</div>
            
            <h3>Ad-Slot-Status</h3>
            <div id="div-gpt-ad-left-status" class="status status-warning">Anzeige wird angefordert...</div>
            <div id="div-gpt-ad-right-status" class="status status-warning">Anzeige wird angefordert...</div>
            <div id="div-gpt-ad-bottom-status" class="status status-warning">Anzeige wird angefordert...</div>
        </div>
        
        <div class="ads-container">
            <div class="sidebar">
                <!-- Linke Testanzeige -->
                <div id="div-gpt-ad-left-test" class="test-ad test-ad-left">
                    <strong>TEST AD</strong>
                    <small>160x600</small>
                </div>
                <div id="div-gpt-ad-left"></div>
            </div>
            
            <div class="main-content">
                <div class="card">
                    <h2>Produktionstestseite</h2>
                    <p>Diese Seite dient zum Testen der Werbeintegration und des Consent Management in einer Produktionsumgebung.</p>
                    <p>Überprüfen Sie:</p>
                    <ul>
                        <li>Ob das CMP korrekt geladen wird</li>
                        <li>Ob der Benutzer Consent geben kann</li>
                        <li>Ob Werbeanzeigen nach Consent korrekt angezeigt werden</li>
                    </ul>
                </div>
                
                <!-- Rechte Testanzeige -->
                <div id="div-gpt-ad-right-test" class="test-ad test-ad-right">
                    <strong>TEST AD</strong>
                    <small>300x250</small>
                </div>
                <div id="div-gpt-ad-right"></div>
            </div>
        </div>
        
        <!-- Untere Testanzeige -->
        <div id="div-gpt-ad-bottom-test" class="test-ad test-ad-banner">
            <strong>TEST AD</strong>
            <small>728x90</small>
        </div>
        <div id="div-gpt-ad-bottom"></div>
        
        <footer>
            <p>&copy; AdTech Toolbox 2023 - Production Test</p>
        </footer>
    </div>
</body>
</html> 