<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <link rel="icon" type="image/svg+xml" href="/adbox-tiny.svg" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>AdTech Toolbox</title>
    
    <!-- Domain-Override für Usercentrics vor dem CMP-Script -->
    <script>
      // Diese Funktion wird das CMP mit der korrekten Domain initialisieren
      window.usercentricsManualStart = function() {
        if (typeof window.UC_UI !== 'undefined' && typeof window.UC_UI.isInitialized === 'function' && !window.UC_UI.isInitialized()) {
          try {
            // Domain Override - wir täuschen vor, auf der Hauptdomain zu sein
            var originalHostname = window.location.hostname;
            var isSubdomain = originalHostname.includes('staging');
            
            if (isSubdomain) {
              console.log('Subdomain detected, applying domain override');
              // Temporärer Override der hostname-Eigenschaft für Usercentrics
              Object.defineProperty(window.location, 'hostname', {
                get: function() {
                  // Während der Usercentrics-Initialisierung die Hauptdomain zurückgeben
                  return 'adtech-toolbox.com';
                },
                configurable: true
              });
            }
            
            console.log('Manual initialization of Usercentrics');
            window.UC_UI.showFirstLayer();
            
            // Hostname-Override rückgängig machen
            if (isSubdomain) {
              Object.defineProperty(window.location, 'hostname', {
                get: function() {
                  return originalHostname;
                },
                configurable: true
              });
            }
          } catch (e) {
            console.error('Error during manual CMP initialization:', e);
          }
        } else {
          console.log('Usercentrics not available for manual start or already initialized');
        }
      };
    </script>
    
    <!-- Usercentrics CMP mit manueller Domain-Konfiguration -->
    <script 
      id="usercentrics-cmp" 
      src="https://web.cmp.usercentrics.eu/ui/loader.js" 
      data-settings-id="AVmhdo98bxlHZn" 
      data-tcf-enabled
      onload="console.log('Usercentrics script loaded')">
    </script>
    
    <!-- Dynamic meta robots tag -->
    <script>
      // Check if this is staging or has no_ads parameter
      const isStaging = window.location.hostname.includes('staging');
      const hasNoAdsParam = window.location.search.includes('no_ads');
      
      if (isStaging || hasNoAdsParam) {
        // Create a meta tag to prevent indexing
        const metaRobots = document.createElement('meta');
        metaRobots.name = 'robots';
        metaRobots.content = 'noindex, nofollow';
        document.head.appendChild(metaRobots);
        console.log('Added noindex meta tag');
      }
    </script>
    
    <!-- Debug helper for Usercentrics -->
    <script>
      // Usercentrics initialization event
      window.addEventListener('UC_UI_INITIALIZED', function() {
        console.log('Usercentrics initialized successfully via event');
      });
      
      // Erweiterte Lösung für Subdomain-Probleme
      window.addEventListener('load', function() {
        setTimeout(function() {
          console.log('Usercentrics status check:', 
            window.UC_UI ? 'Available' : 'Not available',
            window.UC_UI?.isInitialized ? 'Function exists' : 'Function missing',
            window.UC_UI?.isInitialized?.() ? 'Initialized' : 'Not initialized'
          );
          
          // Wenn die automatische Initialisierung fehlgeschlagen ist, versuchen wir es manuell
          if (window.UC_UI && typeof window.UC_UI.isInitialized === 'function' && !window.UC_UI.isInitialized()) {
            console.log('Automatic initialization failed, trying manual start');
            window.usercentricsManualStart();
          }
        }, 1500);
      });
    </script>
    
    <!-- Prebid.js -->
    <script src="/prebid.js"></script>
    
    <!-- GPT -->
    <script src="https://securepubads.g.doubleclick.net/tag/js/gpt.js"></script>
    <script src="/gpt.js"></script>
  </head>
  <body>
    <div id="root"></div>
    <script type="module" src="/src/main.jsx"></script>
  </body>
</html>
